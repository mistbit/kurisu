# Kurisu - AI 量化交易 Agent 需求文档

## 1. 项目概览
**项目名称：** Kurisu (暂定)
**目标：** 构建一个模块化、可扩展且具备现代化 UI 的 AI 驱动量化交易 Agent。
**核心目标：**
1.  **交易执行：** 基于量化分析和 AI 洞察自动化执行交易策略。
2.  **AI Agent 研究：** 在金融市场场景下，探索和实现先进的 Agent 架构（如规划、记忆、工具调用）。
3.  **教育平台：** 作为一个学习工具，帮助用户理解量化金融、策略背后的数学原理以及现代软件架构。

## 2. 目标用户与画像
- **量化交易员：** 希望自动化策略、回测想法并监控实盘表现。
- **AI 研究员：** 希望尝试不同的 LLM 提示词、Agent 架构（如 ReAct, Plan-and-Solve）以及 RAG 实现。
- **学习者：** 希望理解交易背后的逻辑，可视化数学模型（如凯利公式、夏普比率），并学习代码实现。

## 3. 功能需求

### 3.1 数据管理模块
- **多源数据接入：** 支持加密货币（Binance/CCXT）、股票（Yahoo Finance/Alpha Vantage）以及另类数据（新闻/社交媒体）。
- **数据标准化：** 统一 OHLCV（开盘、最高、最低、收盘、成交量）和 Tick 数据的结构。
- **存储：** 高效存储时间序列数据（历史数据和实时数据）。

### 3.2 量化策略引擎
- **策略接口：** 提供标准化的基类用于实现策略（如均线交叉、均值回归、网格交易）。
- **指标库：** 集成 `pandas-ta` 或 `talib` 以支持技术指标计算。
- **回测核心：**
    - 事件驱动的回测引擎。
    - 支持交易成本、滑点模拟和保证金逻辑。
    - 绩效指标：投资回报率 (ROI)、最大回撤 (Max Drawdown)、夏普比率 (Sharpe Ratio)、索提诺比率 (Sortino Ratio)、胜率 (Win Rate)。

### 3.3 AI Agent 核心 ("大脑")
- **LLM 集成：** 支持多种模型（OpenAI, Anthropic, 通过 Ollama 运行的本地模型）。
- **市场情绪分析：** 分析新闻标题和社交情绪，动态调整策略参数。
- **策略生成：** Agent 可以根据自然语言描述生成新的策略代码片段。
- **可解释性：** Agent 必须解释 *为什么* 进行特定交易或推荐，引用数学原理或市场状况。
- **记忆系统：**
    - **短期记忆：** 当前市场会话的上下文窗口。
    - **长期记忆 (向量数据库)：** 历史模式、过去成功的交易案例以及习得的规则。

### 3.4 教育模块
- **交互式教程：** 逐步演示特定策略如何运作。
- **数学可视化：** 可视化公式的 UI 组件（例如：可视化有效前沿 Efficient Frontier）。
- **代码解析：** 针对策略代码的“点击解释”功能。

### 3.5 执行引擎
- **模拟交易 (Paper Trading)：** 用于验证策略的模拟执行环境。
- **实盘交易 (Live Trading)：** 集成交易所 API 进行真实下单。
- **风控管理：** 硬止损、仓位限制和紧急熔断功能。

### 3.6 用户界面 (UI)
- **仪表盘：** 实时图表可视化（TradingView 组件）、账户余额、持仓监控。
- **Agent 对话：** 与 AI 进行对话的聊天界面（例如：“分析过去4小时 BTC 的趋势”）。
- **回测实验室：** 配置并运行回测的表单，以及详细的报告可视化。
- **策略编辑器：** 浏览器端的代码编辑器（Monaco Editor），用于编写/修改策略。

## 4. 非功能需求
- **模块化：** 数据、策略和执行层之间松耦合，允许组件替换。
- **低延迟：** 实时数据摄入和信号生成的低延迟处理。
- **可扩展性：** 能够监控多个资产并并发运行多个策略。
- **安全性：** 安全处理 API 密钥（本地加密或环境变量，绝不存入数据库）。
- **可观测性：** 全面记录所有 Agent 决策和系统错误日志。

## 5. 实施阶段规划
1.  **阶段一 (基础)：** 数据摄入、基础回测引擎、简单 UI。
2.  **阶段二 (AI 集成)：** LLM 连接、情绪分析、基础聊天界面。
3.  **阶段三 (实盘执行)：** 交易所集成、模拟交易、风控管理。
4.  **阶段四 (高级 Agent)：** 自主策略优化、长期记忆系统。
