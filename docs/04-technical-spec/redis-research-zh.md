# Redis 技术调研与竞品分析

本文档提供了 **Redis** 的全面概述，并将其与其他内存数据库进行对比，以说明在 **Kurisu** 项目中选择它的合理性。

## 1. Redis 简介

Redis (Remote Dictionary Server) 是一款开源的内存数据结构存储系统，可用作数据库、缓存、消息中间件和流处理引擎。在像 Kurisu 这样的量化交易系统中，Redis 在处理亚毫秒级延迟的实时数据方面起着至关重要的作用。

### 在 Kurisu 中的核心用途
- **实时行情缓存**：存储最新的 Ticker 价格、订单簿快照（Order Book）和成交事件，供交易策略和 AI Agent 瞬时访问。
- **任务队列 (Celery/RQ)**：管理异步任务，如历史数据下载、回测任务分发和订单异步申报。
- **发布/订阅 (Pub/Sub) 消息机制**：将行情事件从数据引擎分发给多个订阅了该品种的策略模块。
- **状态管理**：存储 AI Agent 的对话上下文、临时交易状态及风控计数器。

## 2. 竞品对比调研

虽然 Redis 是行业标准，但近年来也出现了一些专注于多线程或不同许可模型的替代方案。

| 维度 | Redis | Valkey | Dragonfly | KeyDB | Memcached |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **架构设计** | 单线程 (核心) | Redis 社区分支 | 多线程 (无共享架构) | 多线程 | 多线程 |
| **数据结构** | 极其丰富 (List, Set, Hash 等) | 与 Redis 一致 | 兼容 Redis | 兼容 Redis | 仅简单的 Key-Value |
| **吞吐性能** | 高 (10万+ OPS) | 与 Redis 一致 | **极高 (百万级+ OPS)** | 很高 | 高 |
| **持久化** | RDB & AOF | RDB & AOF | 快照 | RDB & AOF | 无 (仅内存) |
| **开源许可** | RSALv2/SSPL (非 OSI) | **BSD (纯开源)** | BSL | BSD | BSD |
| **生态成熟度** | **统治地位** | 快速增长 (Linux 基金会) | 新兴 | 稳定 | 成熟但功能受限 |

### 详细对比分析

- **Valkey**: 在 Redis 宣布更改开源许可后，由 Linux 基金会牵头、原 Redis 核心维护者参与的社区分支。它 100% 兼容 Redis，是追求纯粹开源的首选。
- **Dragonfly**: 为现代多核硬件设计。在单实例上能达到 Redis 25 倍的吞吐量。但在量化交易的绝大多数场景下，Redis 的单线程性能已绰绰有余，且 Dragonfly 的生态尚在完善中。
- **KeyDB**: 另一个较早的 Redis 多线程分支。支持主动-主动复制等特性，但相比新出现的替代者，其社区活跃度有所下降。
- **Memcached**: 极其简单快速，但缺乏量化系统中必不可少的复杂数据结构（如用于时间窗口查询的 Sorted Sets 或用于流处理的 Streams）。

## 3. 为什么 Kurisu 选择 Redis？

对于 **Kurisu** 项目，Redis 仍然是最务实的工程选择：

1.  **丰富的数据结构**：我们利用 **Sorted Sets** 存储按时间排序的行情快照，利用 **Streams** 进行事件驱动处理。大多数竞争对手在这些高级特性的成熟度上不及 Redis。
2.  **AI 生态支持**：绝大多数 AI 编排框架（如 LangChain/LangGraph）都将 Redis 作为内存存储的首选适配对象。
3.  **Python 兼容性**：`redis-py` 库非常稳定且支持异步（asyncio），是 Python 开发者的标配。
4.  **云平台完美支持**：阿里云等厂商提供的“云数据库 Redis 版”具备成熟的高可用、自动备份和监控能力，上云成本极低。

## 4. 业界主要使用情况

- **高频交易 (HFT)**：作为数据持久化到 TimescaleDB 之前的“热数据”层。
- **交易所接入层**：缓存来自 WebSocket 的原始行情流，缓解下游策略的压力。
- **前端看板**：为交易终端提供实时推送的数据源。
