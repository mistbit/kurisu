# TimescaleDB 技术调研与竞品分析

本文档提供了 **TimescaleDB** 的全面概述，并将其与其他主流时间序列数据库（TSDB）进行对比，以说明在 **Kurisu** 项目中选择它的合理性。

## 1. TimescaleDB 简介

TimescaleDB 是一款作为 **PostgreSQL** 扩展开发的开源时间序列数据库。它结合了关系型数据库的可靠性、生态系统与时间序列数据所需的高性能扩展能力。

### 核心概念
- **超表 (Hypertables)**：TimescaleDB 的核心抽象。对用户而言，超表看起来像标准的 PostgreSQL 表，但在后台，它会根据时间（以及可选的其他列）自动将数据切分为“分块（Chunks）”。
- **持续聚合 (Continuous Aggregates)**：自动维护的时间序列数据物化视图。非常适合对市场数据进行降采样（例如将 1 分钟 K 线聚合为 1 小时 K 线）。
- **数据压缩**：原生列式压缩技术，可将存储空间占用降低 90% 以上。
- **完整 SQL 支持**：与许多专用 TSDB 不同，TimescaleDB 支持完整的 SQL 语法，包括复杂的 `JOIN`、窗口函数和子查询。

## 2. 竞品对比调研

在量化交易和物联网领域，有几款主流数据库各具优势。以下是 TimescaleDB 与主要竞争对手的对比：

| 维度 | TimescaleDB | InfluxDB (v2/v3) | ClickHouse | QuestDB |
| :--- | :--- | :--- | :--- | :--- |
| **底层架构** | PostgreSQL 扩展 | 原生 TSDB | OLAP 列式存储 | 原生列式存储 |
| **查询语言** | **标准 SQL** | Flux / InfluxQL / SQL | 类 SQL | SQL + 时间扩展 |
| **写入性能** | 强 (百万级/秒) | 极强 | **最强 (千万级/秒)** | 极强 |
| **关系型 JOIN** | **原生支持 / 完美** | 较弱 | 优秀 (但较复杂) | 有限 |
| **生态系统** | **庞大 (PostgreSQL)** | 良好 | 快速增长 | 新兴 |
| **典型场景** | 混合负载、量化交易 | 监控、物联网 | 大规模分析 | 高频交易 |

### 详细对比分析

- **InfluxDB**: 曾经的指标监控市场领导者。适合处理海量、简单的指标数据。然而，其非关系型特性使得在同一位置存储元数据（如策略配置、用户信息）变得非常困难。
- **ClickHouse**: 分析性能“怪兽”。在回测中聚合数十亿行数据时表现无敌，但维护成本较高，且对实时交易系统中常见的单行更新/删除操作支持不佳。
- **QuestDB**: 专注于通过向量化执行引擎实现极致性能和低延迟。它速度极快，但缺乏 PostgreSQL 那样成熟的生态系统和深厚的关系型处理能力。

## 3. 为什么 Kurisu 选择 TimescaleDB？

对于集成 **AI Agent** 和 **量化交易** 的 **Kurisu** 项目，TimescaleDB 具有独特优势：

1.  **统一存储**：我们可以在同一个 PostgreSQL 实例中存储行情数据（TSDB）、交易订单（关系型）以及 Agent 记忆（通过 `pgvector` 实现的向量数据）。
2.  **AI 深度集成**：由于 TimescaleDB 本身就是 PostgreSQL，我们可以直接在时间序列数据旁使用 `pgvector`，让 Agent 能够在同一个 SQL 语句中同时查询市场趋势和向量记忆。
3.  **数据生命周期管理**：TimescaleDB 的数据保留策略和持续聚合功能使我们能够轻松管理多年的历史数据，同时保持系统的高响应性。
4.  **开发体验**：Python 的 `SQLAlchemy` 和 `asyncpg` 等库与 TimescaleDB 完美兼容，极大地缩短了开发周期。

## 4. 业界主要使用情况

- **量化金融**：广泛用于存储 OHLCV（K 线）数据、成交日志和订单簿快照。
- **加密货币平台**：许多 DEX/CEX 聚合器使用它来驱动图表和历史数据 API 端点。
- **金融科技 (FinTech)**：用于欺诈检测和实时交易监控，这些场景需要将时间序列分析与用户元数据结合。
